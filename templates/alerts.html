<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Security Alerts - HealthGuard Medical System</title>
    <link rel="stylesheet" href="/static/medical.css">
</head>

<body>

    <!-- Header -->
    <div class="header">
        <div class="header-content">
            <a href="/" class="logo">
                <div class="logo-icon">üè•</div>
                <span>HealthGuard</span>
            </a>
            <div class="nav-menu">
                <a href="/" class="nav-link">Dashboard</a>
                <a href="/charts" class="nav-link">Analytics</a>
                <a href="/alerts" class="nav-link active">Security</a>
                <button class="theme-toggle" id="themeToggle">
                    üåô Dark Mode
                </button>
                <a href="/logout" class="btn btn-secondary">Logout</a>
            </div>
        </div>
    </div>

    <div class="app">

        <!-- Sidebar -->
        <div class="sidebar">
            <h2>Security Overview</h2>

            <div class="alert alert-info mb-24">
                <strong>üõ°Ô∏è Active Monitoring</strong>
                <p style="margin-top: 8px; font-size: 0.875rem;">
                    AI-powered facial recognition actively protecting your facility 24/7.
                </p>
            </div>

            <h2>System Status</h2>
            <div class="profile-card">
                <div class="profile-label">Recognition Model</div>
                <div class="profile-value">VGG-Face</div>
            </div>

            <div class="profile-card">
                <div class="profile-label">Threshold</div>
                <div class="profile-value">0.35 (Strict)</div>
            </div>

            <div class="profile-card">
                <div class="profile-label">Status</div>
                <div class="profile-value status-success">‚óè Active</div>
            </div>

            <h2 style="margin-top: 24px;">Quick Actions</h2>
            <div class="sidebar-nav">
                <button class="sidebar-link w-full" onclick="refreshImage()"
                    style="border: none; background: none; cursor: pointer; text-align: left;">
                    <span>üîÑ</span>
                    <span>Refresh Image</span>
                </button>
                <a href="/" class="sidebar-link">
                    <span>üìä</span>
                    <span>Back to Dashboard</span>
                </a>
            </div>
        </div>

        <!-- Main Content -->
        <div class="main">
            <div class="container">

                <div class="page-header flex justify-between items-center">
                    <div>
                        <h1 class="page-title">üõ°Ô∏è Security Alert Center</h1>
                        <p class="page-subtitle">Intruder detection and access control monitoring</p>
                    </div>
                    <button onclick="refreshImage()" class="btn btn-primary">
                        üîÑ Refresh
                    </button>
                </div>

                <!-- Security Status Cards -->
                <div class="grid grid-2 mb-32">
                    <div class="card">
                        <h3 class="card-title">üéØ Detection Accuracy</h3>
                        <div class="card-value">99.8<span class="card-unit">%</span></div>
                        <p style="margin-top: 8px; color: var(--gray-600); font-size: 0.875rem;">
                            High precision facial recognition
                        </p>
                    </div>

                    <div class="card">
                        <h3 class="card-title">‚ö° Response Time</h3>
                        <div class="card-value">
                            <span style="font-size: 2rem; font-weight: 700; color: var(--medical-blue);"
                                id="captureTime">--</span>
                        </div>
                        <p style="margin-top: 8px; color: var(--gray-600); font-size: 0.875rem;">
                            Last capture timestamp
                        </p>
                    </div>
                </div>

                <!-- Main Intruder Detection Card -->
                <div class="card">
                    <div class="flex justify-between items-center mb-24">
                        <h3 class="card-title" style="margin: 0;">üì∏ Latest Security Capture</h3>
                        <span class="badge badge-info">Live Feed</span>
                    </div>

                    <div id="imageContainer" style="margin-top: 24px;">
                        <img id="intruderImg" src="" alt="Security capture"
                            style="width: 100%; max-width: 600px; border-radius: var(--radius-lg); border: 2px solid var(--gray-200); box-shadow: var(--shadow-md); display: none; margin: 0 auto;">

                        <div id="noImagePlaceholder"
                            style="text-align: center; padding: 80px 20px; background: var(--gray-50); border-radius: var(--radius-lg); border: 2px dashed var(--gray-300);">
                            <div style="font-size: 4rem; margin-bottom: 16px;">üîí</div>
                            <h3 style="color: var(--gray-700); margin-bottom: 8px;">No Unauthorized Access Detected</h3>
                            <p style="color: var(--gray-500);">System is actively monitoring all entry points</p>
                            <div class="spinner" style="margin: 24px auto 0;"></div>
                        </div>
                    </div>

                    <div id="imageInfo"
                        style="margin-top: 24px; padding: 20px; background: var(--gray-50); border-radius: var(--radius-md); display: none;">
                        <div class="flex items-center justify-between">
                            <div>
                                <p style="font-size: 0.875rem; color: var(--gray-600); margin-bottom: 4px;">
                                    <strong>Status:</strong> <span class="status-danger">‚ö†Ô∏è Unauthorized Access</span>
                                </p>
                                <p style="font-size: 0.875rem; color: var(--gray-600);">
                                    <strong>Detected:</strong> <span id="detectTime">--</span>
                                </p>
                            </div>
                            <span class="badge badge-danger">Alert Sent</span>
                        </div>
                    </div>
                </div>

                <!-- System Information -->
                <div class="card mt-32">
                    <h3 class="card-title">‚ÑπÔ∏è Security System Features</h3>
                    <div class="grid grid-2" style="margin-top: 20px;">
                        <div style="padding: 16px; background: var(--gray-50); border-radius: var(--radius-md);">
                            <div style="font-size: 1.5rem; margin-bottom: 8px;">‚úì</div>
                            <h4 style="font-weight: 600; margin-bottom: 4px;">AI Face Recognition</h4>
                            <p style="color: var(--gray-600); font-size: 0.875rem;">
                                Advanced VGG-Face model with strict 0.35 threshold
                            </p>
                        </div>

                        <div style="padding: 16px; background: var(--gray-50); border-radius: var(--radius-md);">
                            <div style="font-size: 1.5rem; margin-bottom: 8px;">‚úì</div>
                            <h4 style="font-weight: 600; margin-bottom: 4px;">Instant Alerts</h4>
                            <p style="color: var(--gray-600); font-size: 0.875rem;">
                                WhatsApp notifications sent immediately to security team
                            </p>
                        </div>

                        <div style="padding: 16px; background: var(--gray-50); border-radius: var(--radius-md);">
                            <div style="font-size: 1.5rem; margin-bottom: 8px;">‚úì</div>
                            <h4 style="font-weight: 600; margin-bottom: 4px;">24/7 Monitoring</h4>
                            <p style="color: var(--gray-600); font-size: 0.875rem;">
                                Continuous surveillance with encrypted data storage
                            </p>
                        </div>

                        <div style="padding: 16px; background: var(--gray-50); border-radius: var(--radius-md);">
                            <div style="font-size: 1.5rem; margin-bottom: 8px;">‚úì</div>
                            <h4 style="font-weight: 600; margin-bottom: 4px;">HIPAA Compliant</h4>
                            <p style="color: var(--gray-600); font-size: 0.875rem;">
                                Fully compliant with medical data privacy standards
                            </p>
                        </div>
                    </div>
                </div>

            </div>
        </div>

    </div>

    <script>
        async function refreshImage() {
            await loadIntruderImage();
        }

        async function loadIntruderImage() {
            try {
                const res = await fetch("/data");
                const data = await res.json();

                const imgElement = document.getElementById("intruderImg");
                const placeholder = document.getElementById("noImagePlaceholder");
                const imageInfo = document.getElementById("imageInfo");
                const timeElement = document.getElementById("captureTime");

                if (data.intruder_image) {
                    // Show image
                    imgElement.src = "/" + data.intruder_image + "?t=" + Date.now();
                    imgElement.style.display = "block";
                    placeholder.style.display = "none";
                    imageInfo.style.display = "block";

                    // Show detection time
                    const now = new Date();
                    document.getElementById("detectTime").textContent = now.toLocaleString();
                    timeElement.textContent = now.toLocaleTimeString();
                } else {
                    // Show placeholder
                    imgElement.style.display = "none";
                    placeholder.style.display = "block";
                    imageInfo.style.display = "none";
                    timeElement.textContent = "--";
                }
            } catch (err) {
                console.error("Error loading intruder image:", err);
            }
        }

        // Auto-refresh every 5 seconds
        setInterval(loadIntruderImage, 5000);
        loadIntruderImage();
    </script>

    <script src="/static/theme.js"></script>

</body>

</html>